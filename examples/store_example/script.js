"use strict";(()=>{var x=!1,_=!1,E=[],H=-1;function $(e){J(e)}function J(e){E.includes(e)||E.push(e),K()}function K(){!_&&!x&&(x=!0,queueMicrotask(D))}function D(){x=!1,_=!0;for(let e=0;e<E.length;e++)E[e](),H=e;E.length=0,H=-1,_=!1}var w=["push","pop","shift","unshift","splice","sort","reverse"],y=null,V=new WeakMap;function O(e,n){if(!y)return;console.log(`Tracking key "${String(n)}"`);let t=V.get(e);t||V.set(e,t=new Map);let o=t.get(n);o||t.set(n,o=new Set),o.add(y),y.deps.add(o)}function m(e,n){let t=V.get(e);if(!t)return;console.log(`Trigering dependencies of key "${String(n)}"`);let o=t.get(n);o&&o.forEach(r=>$(r))}function R(e){return typeof e!="object"||e===null||e.__isReactive?e:new Proxy(e,{get(n,t,o){if(t==="__isReactive")return!0;let r=Reflect.get(n,t,o);return Array.isArray(n)&&w.includes(t)||O(n,t),Array.isArray(n)&&w.includes(t)?(...i)=>{let s=n.length,l=r.apply(n,i);return n.length!==s&&m(n,"length"),m(n,t),l}:typeof r=="object"&&r!==null?R(r):r},set(n,t,o,r){let i=Reflect.get(n,t,r),s=Reflect.set(n,t,o,r);return o!==i&&(m(n,t),Array.isArray(n)&&t!=="length"&&!isNaN(Number(t))&&Number(t)>=n.length-1&&m(n,"length")),s},deleteProperty(n,t){let o=Reflect.deleteProperty(n,t);return m(n,t),o}})}function f(e){let n=()=>{let t=new Set,o=n.deps;n.deps=t;let r=y;y=n;try{e()}finally{y=r}o.forEach(i=>{n.deps.has(i)||i.delete(n)})};return n.deps=new Set,n(),()=>{n.deps.forEach(t=>t.delete(n)),n.deps.clear()}}function S(e){if(M(e))return e;let n={__isRef:!0,_value:e,get value(){return O(n,"value"),this._value},set value(t){if(t!==this._value){if(Array.isArray(t)){let o=R([...t]);this._value=new Proxy(o,{get(r,i,s){let l=Reflect.get(r,i,s);return typeof l=="function"&&w.includes(i)?function(...c){let F=l.apply(this,c);return m(n,"value"),F}:l},set(r,i,s,l){let c=Reflect.set(r,i,s,l);return isNaN(Number(i))||m(n,"value"),c}})}else this._value=t;m(n,"value")}}};if(Array.isArray(e)){let t=R([...e]);n._value=new Proxy(t,{get(o,r,i){let s=Reflect.get(o,r,i);return typeof s=="function"&&w.includes(r)?function(...l){let c=s.apply(this,l);return m(n,"value"),c}:s},set(o,r,i,s){let l=Reflect.set(o,r,i,s);return isNaN(Number(r))||m(n,"value"),l}})}else typeof e=="object"&&e!==null&&(n._value=R(e));return n}function M(e){return!!(e&&e.__isRef===!0)}function T(e){return typeof e=="object"&&e!==null}function b(e){return typeof e=="function"}function d(e){return M(e)?e.value:b(e)?e():e}var P=new Map;function g(e,n){P.set(e,n)}function A(e,n,t,o){let r=P.get(n);if(r)return r(e,t,o);if(n.startsWith("on")&&b(t)){let i=n.slice(2).toLowerCase(),s=l=>t(l,e);return e.addEventListener(i,s),()=>e.removeEventListener(i,s)}if(!n.startsWith("_")&&!n.startsWith("$"))return f(()=>{let i=d(t);e[n]!==i&&(e[n]=i)})}function B(){g("$text",q),g("$show",W),g("$class",U),g("$style",Z),g("$for",G),g("$each",()=>{}),g("$key",()=>{})}function q(e,n){f(()=>{let t=d(n),o=String(t);e.textContent!==o&&(e.textContent=o)})}function W(e,n){f(()=>{let t,o=0;I(n)?(t=d(n.value),o=n.hideDelay||0):t=d(n);let r=e;r._shouldShow!==t&&(!t&&o>0?(r._shouldShow=!1,setTimeout(()=>{e.style.display="none"},o)):(r._shouldShow=t,e.style.display=t?"block":"none"))})}function I(e){return typeof e=="object"&&e!==null&&"value"in e}function U(e,n){let t=e;return t._originalClasses||(t._originalClasses=new Set(Array.from(t.classList))),f(()=>{let o=d(n);t._viletClasses&&t._viletClasses.forEach(i=>t.classList.remove(i));let r=new Set;typeof o=="string"?o.split(/\s+/).forEach(i=>{i.trim()&&r.add(i.trim())}):Array.isArray(o)?o.forEach(i=>{typeof i=="string"?r.add(i):T(i)&&Object.entries(i).forEach(([s,l])=>{d(l)&&r.add(s)})}):T(o)&&Object.entries(o).forEach(([i,s])=>{d(s)&&r.add(i)}),r.forEach(i=>t.classList.add(i)),t._viletClasses=r})}function Z(e,n){let t=e;return t._originalStyle===void 0&&(t._originalStyle=t.getAttribute("style")||""),f(()=>{let o=d(n);t._viletStyles&&Object.keys(t._viletStyles).forEach(i=>{t.style.removeProperty(i)}),t._originalStyle?t.setAttribute("style",t._originalStyle):t.removeAttribute("style");let r={};if(typeof o=="string"){let i=o.trim();if(i){let s=t.getAttribute("style")||"",l=s&&!s.endsWith(";")?"; ":"",c=i.endsWith(";")?i:i+";";t.setAttribute("style",s+l+c),z(c,r)}}else T(o)&&Object.entries(o).forEach(([i,s])=>{let l=d(s);if(l!=null){let c=k(i);t.style.setProperty(c,String(l)),r[c]=String(l)}});t._viletStyles=r})}function k(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}function z(e,n){e.split(";").filter(o=>o.trim()).forEach(o=>{let r=o.indexOf(":");if(r>0){let i=o.substring(0,r).trim(),s=o.substring(r+1).trim();i&&s&&(n[i]=s)}})}function G(e,n,t){let o=new Map,r=new Map,i=new WeakMap,s=0;return f(()=>{let l=d(n);if(!Array.isArray(l))return;let c=l.map((a,u)=>t.$key?t.$key(a,u):typeof a=="object"&&a!==null?(i.has(a)||i.set(a,`obj_${s++}`),i.get(a)):`${a}_${u}`);Array.from(o.keys()).filter(a=>!c.includes(a)).forEach(a=>{let u=o.get(a);u&&(u.unmount(e),o.delete(a));let p=r.get(a);p&&p.length>0&&(p.forEach(v=>v()),r.delete(a))}),c.forEach((a,u)=>{if(!o.has(a)){if(t.$each===void 0)throw new Error("required $each binding is missing for $for binding");let[p,v]=Q(t.$each(l[u],u));p.mount(e),o.set(a,p),r.set(a,v)}}),c.forEach((a,u)=>{let p=o.get(a);if(p?.elements?.length){let v=p.elements[0],j=Array.from(e.children).indexOf(v);j!==u&&j!==-1&&p.elements.forEach(N=>{u>=e.children.length?e.appendChild(N):e.insertBefore(N,e.children[u])})}})})}function Q(e){let n=null,t=[];if(e.forEach(o=>{if(o)if("mounted"in o){if(n)throw new Error("$each must not return more than one templateRef");n=o}else t.push(...o.cleanup)}),!n)throw new Error("$each has to return a templateRef");return[n,t]}function h(e){if(!T(e))return null;let n=e.$root??document,t=e.$element??e.$el??n.querySelector(e.$selector??e.$select??e.$??"");if(!t)return null;let o=[];for(let[r,i]of Object.entries(e)){let s=A(t,r,i,e);b(s)&&o.push(s)}return{element:t,cleanup:o,destroy(){this.cleanup.forEach(r=>r())}}}function L(e){let n=document.querySelector(e);if(!n||!(n instanceof HTMLTemplateElement))return null;let t=n.content.cloneNode(!0);return{mounted:!1,elements:[],fragment:t,mount(r){this.elements=Array.from(t.childNodes),this.mounted=!0,r.appendChild(t)},unmount(r){this.mounted=!1,this.elements.forEach(i=>{i.parentNode===r&&r.removeChild(i)}),this.elements=[]}}}B();function C(e,n){let t=n.storage||"localStorage";if(!(t in window)){console.warn(`Cannot use store plugin, since ${t} is not available`);return}let o=window[t],r=o.getItem(n.key);r&&(n.onload?n.onload(JSON.parse(r)):(console.log(`Load store: ${r}`),e.value=JSON.parse(r))),f(()=>{console.log(`Store effect: ${e.value}`),o.setItem(n.key,JSON.stringify(e.value))})}function X(){let e=S(0);C(e,{key:"counter_count"}),h({$selector:"#counter-button",onClick:()=>e.value++}),h({$selector:"#counter-display",textContent:e})}function Y(){let e=S([]),n=S("");f(()=>console.log(`Todo change: ${JSON.stringify(e.value)}`)),e.value=[],C(e,{key:"todolist_todos"}),C(n,{key:"todo_title_input",storage:"sessionStorage"}),h({$selector:"#container",$for:e,$key:t=>t.id,$each:t=>{let o=L("#todo-template");if(!o)throw new Error("#todo-template not found");let r=h({$root:o.fragment,$selector:"#card",onclick:()=>{e.value=e.value.filter(s=>s.id!==t.id)}}),i=h({$root:o.fragment,$selector:"#title",textContent:t.title});return[o,r,i]}}),h({$selector:"#title-input",value:n,oninput:t=>{n.value=t.target?.value}}),h({$selector:"#add-button",onclick:()=>{e.value.push({id:crypto.randomUUID(),title:n.value}),n.value=""}})}X();Y();})();
