"use strict";(()=>{var R=!1,C=!1,E=[],j=-1;function _(e){K(e)}function K(e){E.includes(e)||E.push(e),B()}function B(){!C&&!R&&(R=!0,queueMicrotask(D))}function D(){R=!1,C=!0;for(let e=0;e<E.length;e++)E[e](),j=e;E.length=0,j=-1,C=!1}var k=["push","pop","shift","unshift","splice","sort","reverse"],h=null,w=new WeakMap;function A(e,n){if(!h)return;let t=w.get(e);t||w.set(e,t=new Map);let o=t.get(n);o||t.set(n,o=new Set),o.add(h),h.deps.add(o)}function g(e,n){let t=w.get(e);if(!t)return;let o=t.get(n);o&&o.forEach(r=>_(r))}function b(e){return typeof e!="object"||e===null||e.__isReactive?e:new Proxy(e,{get(n,t,o){if(t==="__isReactive")return!0;let r=Reflect.get(n,t,o);return A(n,t),Array.isArray(n)&&k.includes(t)?(...i)=>{let s=n.length,l=r.apply(n,i);return n.length!==s&&g(n,"length"),l}:typeof r=="object"&&r!==null?b(r):r},set(n,t,o,r){let i=Reflect.get(n,t,r),s=Reflect.set(n,t,o,r);return o!==i&&(g(n,t),Array.isArray(n)&&t!=="length"&&!isNaN(Number(t))&&Number(t)>=n.length-1&&g(n,"length")),s},deleteProperty(n,t){let o=Reflect.deleteProperty(n,t);return g(n,t),o}})}function c(e){let n=()=>{let t=new Set,o=n.deps;n.deps=t;let r=h;h=n;try{e()}finally{h=r}o.forEach(i=>{n.deps.has(i)||i.delete(n)})};return n.deps=new Set,n(),()=>{n.deps.forEach(t=>t.delete(n)),n.deps.clear()}}function v(e){if(x(e))return e;let n={__isRef:!0,_value:e,get value(){return A(n,"value"),this._value},set value(t){t!==this._value&&(this._value=t,g(n,"value"))}};if(Array.isArray(e)){n._value=b([...e]),["push","pop","shift","unshift","splice","sort","reverse"].forEach(r=>{let i=n._value[r];typeof i=="function"&&Object.defineProperty(n._value,r,{value:function(...s){let l=i.apply(this,s);return g(n,"value"),l},writable:!0,configurable:!0,enumerable:!1})});let o=n._value;n._value=new Proxy(o,{set(r,i,s,l){let p=Reflect.set(r,i,s,l);return isNaN(Number(i))||g(n,"value"),p}})}else typeof e=="object"&&e!==null&&(n._value=b(e));return n}function x(e){return!!(e&&e.__isRef===!0)}function T(e){return typeof e=="object"&&e!==null}function S(e){return typeof e=="function"}function u(e){return x(e)?e.value:S(e)?e():e}var F=new Map;function d(e,n){F.set(e,n)}function $(e,n,t,o){let r=F.get(n);if(r)return r(e,t,o);if(n.startsWith("on")&&S(t)){let i=n.slice(2).toLowerCase(),s=l=>t(l,e);return e.addEventListener(i,s),()=>e.removeEventListener(i,s)}if(!n.startsWith("_")&&!n.startsWith("$"))return c(()=>{let i=u(t);e[n]!==i&&(e[n]=i)})}function O(){d("$text",q),d("$show",W),d("$class",U),d("$style",Z),d("$for",Q),d("$each",()=>{}),d("$key",()=>{})}function q(e,n){c(()=>{let t=u(n),o=String(t);e.textContent!==o&&(e.textContent=o)})}function W(e,n){c(()=>{let t,o=0;I(n)?(t=u(n.value),o=n.hideDelay||0):t=u(n);let r=e;r._shouldShow!==t&&(!t&&o>0?(r._shouldShow=!1,setTimeout(()=>{e.style.display="none"},o)):(r._shouldShow=t,e.style.display=t?"block":"none"))})}function I(e){return typeof e=="object"&&e!==null&&"value"in e}function U(e,n){let t=e;return t._originalClasses||(t._originalClasses=new Set(Array.from(t.classList))),c(()=>{let o=u(n);t._viletClasses&&t._viletClasses.forEach(i=>t.classList.remove(i));let r=new Set;typeof o=="string"?o.split(/\s+/).forEach(i=>{i.trim()&&r.add(i.trim())}):Array.isArray(o)?o.forEach(i=>{typeof i=="string"?r.add(i):T(i)&&Object.entries(i).forEach(([s,l])=>{u(l)&&r.add(s)})}):T(o)&&Object.entries(o).forEach(([i,s])=>{u(s)&&r.add(i)}),r.forEach(i=>t.classList.add(i)),t._viletClasses=r})}function Z(e,n){let t=e;return t._originalStyle===void 0&&(t._originalStyle=t.getAttribute("style")||""),c(()=>{let o=u(n);t._viletStyles&&Object.keys(t._viletStyles).forEach(i=>{t.style.removeProperty(i)}),t._originalStyle?t.setAttribute("style",t._originalStyle):t.removeAttribute("style");let r={};if(typeof o=="string"){let i=o.trim();if(i){let s=t.getAttribute("style")||"",l=s&&!s.endsWith(";")?"; ":"",p=i.endsWith(";")?i:i+";";t.setAttribute("style",s+l+p),G(p,r)}}else T(o)&&Object.entries(o).forEach(([i,s])=>{let l=u(s);if(l!=null){let p=z(i);t.style.setProperty(p,String(l)),r[p]=String(l)}});t._viletStyles=r})}function z(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}function G(e,n){e.split(";").filter(o=>o.trim()).forEach(o=>{let r=o.indexOf(":");if(r>0){let i=o.substring(0,r).trim(),s=o.substring(r+1).trim();i&&s&&(n[i]=s)}})}function Q(e,n,t){let o=new Map,r=new WeakMap,i=0;return c(()=>{let s=u(n);if(!Array.isArray(s))return;let l=s.map((a,f)=>t.$key?t.$key(a,f):typeof a=="object"&&a!==null?(r.has(a)||r.set(a,`obj_${i++}`),r.get(a)):`${a}_${f}`);Array.from(o.keys()).filter(a=>!l.includes(a)).forEach(a=>{let f=o.get(a);f&&(f.unmount(e),o.delete(a))}),l.forEach((a,f)=>{if(!o.has(a)){if(t.$each===void 0)throw new Error("required $each binding is missing for $for binding");let y=t.$each(s[f],f);y.mount(e),o.set(a,y)}}),l.forEach((a,f)=>{let y=o.get(a);if(y?.elements?.length){let J=y.elements[0],L=Array.from(e.children).indexOf(J);L!==f&&L!==-1&&y.elements.forEach(H=>{f>=e.children.length?e.appendChild(H):e.insertBefore(H,e.children[f])})}})})}function m(e){if(!T(e))return;let n=e.$root??document,t=e.$element??e.$el??n.querySelector(e.$selector??e.$select??e.$??"");if(!t)throw new Error("Element not found");let o=[];for(let[r,i]of Object.entries(e)){let s=$(t,r,i,e);S(s)&&o.push(s)}return{element:t,cleanup:o,destroy(){this.cleanup.forEach(r=>r())}}}function M(e){let n=document.querySelector(e);if(!n||!(n instanceof HTMLTemplateElement))return null;let t=n.content.cloneNode(!0);return{mounted:!1,elements:[],fragment:t,mount(r){this.elements=Array.from(t.childNodes),this.mounted=!0,r.appendChild(t)},unmount(r){this.mounted=!1,this.elements.forEach(i=>{i.parentNode===r&&r.removeChild(i)}),this.elements=[]}}}O();var N=0;function P(){let e=N;return N++,`vilet_${e}`}function V(e,n){let t=n?.storage||"localStorage";if(!(t in window)){console.warn(`Cannot use store plugin, since ${t} is not available`);return}let o=window[t],r=o.getItem(n?.key??P());r&&(n?.onload?n.onload(JSON.parse(r)):(console.log(`Load store: ${r}`),e.value=JSON.parse(r))),c(()=>{console.log(`Store effect: ${e.value}`),o.setItem(n?.key??P(),JSON.stringify(e.value))})}function X(){let e=v(0);V(e,{key:"counter_count"}),m({$selector:"#counter-button",onClick:()=>e.value++}),m({$selector:"#counter-display",textContent:e})}function Y(){let e=v([]),n=v("");c(()=>console.log(`Todo change: ${JSON.stringify(e.value)}`)),e.value=[],V(n,{key:"todo_title_input",storage:"sessionStorage"}),m({$selector:"#container",$for:e,$key:t=>t.id,$each:t=>{let o=M("#todo-template");if(!o)throw new Error("#todo-template not found");return m({$root:o.fragment,$selector:"#card",onclick:()=>{e.value=e.value.filter(r=>r.id!==t.id)}}),m({$root:o.fragment,$selector:"#title",textContent:t.title}),o}}),m({$selector:"#title-input",value:n,oninput:t=>{n.value=t.target?.value}}),m({$selector:"#add-button",onclick:()=>{e.value.push({id:crypto.randomUUID(),title:n.value}),n.value=""}})}function ee(){console.log("Start test");let e=v([]);c(()=>console.log(`Test: ${JSON.stringify(e.value)}`)),e.value=[],e.value=[0,1,2],e.value.pop(),setTimeout(()=>e.value.push(4)),console.log("End test")}X();Y();ee();})();
